var LocationFinder=function(n,t){function i(t){var i=this;i.element=t;i.$element=n(t);i.$locationName=i.$element.find("[data-ref=location]");i.$findMeBtn=i.$element.find("[data-ref=find-me]");i.$submitButtons=i.$element.find("input[type=submit], button[type=submit], .submit");i.action=i.$element.attr("action");i.noGeoMessage=i.$element.attr("data-geocoding-not-available-text");i.geoErrorMessage=i.$element.attr("data-geocoding-not-available-text")}return i.prototype.Init=function(){var i=this;i.$submitButtons.off("click").on("click",function(t){t.preventDefault();i._locFormValidate()&&(window.location.href=i.action+"?"+n.formExtensions.buildQueryString(i.$element))});i.$locationName.on("blur",function(){n(this).attr("placeholder",n(this).attr("data-placeholder"))}).on("focus",function(){n(this).attr("placeholder","");var t=n(".loc-err");t.length&&i.$element.find(".error-label").remove()});i.$locationName.on("keyup",function(t){var r,u;return t.keyCode===13&&(t.preventDefault(),!n(this).val())?(r=i.$element.find(".ph"),r.css("display","none"),u=i._getErrorElement(),i.$element.find(".loc-input-wrapper").prepend(u),!1):!0});if(i._supportGeoLocation())i.$findMeBtn.on("click",function(r){r.preventDefault();i.$findMeBtn.addClass("sp-circle");t.getPositionFromGeolocation().done(function(t){var r=n.formExtensions.buildQueryString(i.$element,function(){return[{name:"lat",value:t.latitude},{name:"lng",value:t.longitude}]},function(n){return n.name!==i.$locationName.attr("name")&&!!n.value});window.location.href=i.action+"?"+r}).fail(function(){i.$findMeBtn.removeClass("sp-circle");alert(i.geoErrorMessage)})})},i.prototype._supportGeoLocation=function(){var t=window.location.protocol==="https:"||window.location.hostname==="localhost";return window&&window.location&&t&&window.navigator&&window.navigator.geolocation&&n.isFunction(window.navigator.geolocation.getCurrentPosition)},i.prototype._locFormValidate=function(){var t=this,r=t._getErrorElement(),i=t.$element.find(".error-label");return t.$locationName.val()&&t.$locationName.val().trim().length?(i.remove(),!0):(i.length||n(r).insertAfter(t.$locationName),i.length&&(i.remove(),n(r).insertAfter(t.$locationName)),!1)},i.prototype._getErrorElement=function(){var t=n("#locationFormError").val();return t?'<span class="error-label err" role="alert">'+t+"<\/span>":'<span class="error-label err" role="alert">Please enter your search terms<\/span>'},i}($,BrowserGeoPositionDetector);$(function(){$('[data-for="LocationFinder.js"]').each(function(){var n=new LocationFinder(this);n.Init()})})